<html>
	<head>
		<title>Clockword</title>
		<script src="http://d3js.org/d3.v2.js"></script>
		<script type="text/javascript">

		var Clockword = function(el, options) {
			this.canvas = options.canvas || 500;
			this.width = this.canvas-4;
			this.x = this.width/2;
			this.y = this.width/2;
			this.radius = this.width/2;
			this.middle_letter = options.middle_letter || 'P';
			this.word_length = options.word_length || 6;
			this.answers = options.answers;

			this.r = d3.scale.linear()
						.domain([0, this.word_length])
						.range([0, this.radius]);

			this.theta = d3.scale.linear()
							.domain([0, 12])
							.range([0, 2*Math.PI]);

			clockword = d3.select(el)
								.append('svg')
									.attr('class', 'clockword')
									.attr('width', this.canvas)
								.append("g")
									.attr("transform", "translate(2,2)");

			clockword.append('circle')
						.attr('r', this.radius)
						.attr('cy', this.y)
						.attr('cx', this.x)
						.style('stroke-width', 2)
						.style('stroke', 'black')
						.style('fill-opacity', 0);

			for(var i=this.word_length; i>=1; i--) {
				circle = clockword.append('circle')
						.attr('r', this.r(i))
						.attr('cy', this.y)
						.attr('cx', this.x)
						.style('stroke-width', 1)
						.style('stroke', 'black');

				if (i==1 || i==this.word_length) {
					circle.style('fill', '#ccc');
				}
				else {
					circle.style('fill', 'white');
				}
			}

			for (var i=1; i<=12; i++) {
				clockword.append('line')
						.attr('x1', (this.x) + (1/this.word_length)*this.radius*Math.sin(this.theta(i)) )
						.attr('y1', (this.y) - (1/this.word_length)*this.radius*Math.cos(this.theta(i)) )
						.attr('x2', (this.x) + this.radius*Math.sin(this.theta(i)) )
						.attr('y2', (this.y) - this.radius*Math.cos(this.theta(i)) )
						.style("stroke", "black");
			}

			clockword.append('text')
						.attr('x', this.x)
						.attr('y', this.y)
						.attr('text-anchor', 'middle')
						.attr('dy', ".35em")
						.style('font-size', '3em')
						.text(this.middle_letter);

			this.clockword = clockword;

			for(i=0; i<12; i++) {
				for(j=0; j<this.word_length-1; j++) {
					this.insert_letter(answers[i][j], {hour:i+1, indent:j+1});
				}
			}
		}

		Clockword.prototype.insert_letter = function(letter, pos) {
			var hour = pos.hour;
			var indent = pos.indent;
			var from_centre = this.word_length - indent + 0.5;
			hour = hour - 0.5;
			letter = letter.toUpperCase();

			this.clockword.append('text')
							.attr('x', this.x + this.r(from_centre)*Math.sin(this.theta(hour)) )
							.attr('y', this.y - this.r(from_centre)*Math.cos(this.theta(hour)) )
							.attr('text-anchor', 'middle')
							.attr('dy', ".35em")
							.text(letter);
		};

		</script>
	</head>
	<body>
		<div id="clockword">
		</div>
		<script type="text/javascript">
			answers = ['hatred', 
						'waited', 
						'elated', 
						'looted',
						'demand',
						'attend',
						'append',
						'friend',
						'fitted',
						'afraid',
						'scared',
						'intend'];
			clockword = new Clockword('#clockword', {middle_letter: 'D', answers: answers});
		</script>
	</body>
</html>